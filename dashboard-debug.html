<!DOCTYPE html>
<html>
<head>
    <title>Dashboard Debug</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .section { background: #f0f0f0; padding: 20px; border-radius: 5px; margin: 10px 0; }
        .error { background: #ffebee; color: #c62828; padding: 10px; border-radius: 5px; }
        .success { background: #e8f5e8; color: #2e7d32; padding: 10px; border-radius: 5px; }
        .info { background: #e3f2fd; color: #1565c0; padding: 10px; border-radius: 5px; }
    </style>
</head>
<body>
    <h1>Dashboard Debug Tool</h1>
    
    <div class="section">
        <h3>Authentication Test</h3>
        <div id="auth-result">Testing...</div>
    </div>
    
    <div class="section">
        <h3>Stats API Test</h3>
        <div id="stats-result">Testing...</div>
    </div>
    
    <div class="section">
        <h3>Test Results API Test</h3>
        <div id="results-result">Testing...</div>
    </div>
    
    <div class="section">
        <h3>Dashboard Simulation</h3>
        <div id="dashboard-sim">Testing...</div>
    </div>

    <script>
        const token = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6InVzZXItMTc2MTA0NzExMTcyMCIsImVtYWlsIjoicmFtb24uc2ljcmVAZ21haWwuY29tIiwicm9sZSI6InRlc3RlciIsImlhdCI6MTc2MTA1MDc3NCwiZXhwIjoxNzYxMTM3MTc0fQ.tobGE1lVtlic9tr2zloSZb1FfBgk4WQ-vjB3dPRUr70';
        const baseUrl = 'https://qa-testing-ddseizosq-lfgstudios-projects.vercel.app';
        
        // Test Authentication
        fetch(`${baseUrl}/api/test-cases/stats`, {
            headers: {
                'Authorization': `Bearer ${token}`
            }
        })
        .then(response => {
            if (response.ok) {
                document.getElementById('auth-result').innerHTML = `
                    <div class="success">
                        ✅ Authentication Working!<br>
                        Status: ${response.status}<br>
                        User: ramon.sicre@gmail.com
                    </div>
                `;
            } else {
                document.getElementById('auth-result').innerHTML = `
                    <div class="error">
                        ❌ Authentication Failed: ${response.status} ${response.statusText}
                    </div>
                `;
            }
            return response.json();
        })
        .then(data => {
            document.getElementById('stats-result').innerHTML = `
                <div class="success">
                    ✅ Stats API Working!<br>
                    Total: ${data.total}<br>
                    Correct: ${data.correct}<br>
                    Incorrect: ${data.incorrect}<br>
                    <strong>This is the data the dashboard should display!</strong>
                </div>
            `;
        })
        .catch(error => {
            document.getElementById('stats-result').innerHTML = `
                <div class="error">
                    ❌ Stats API Error: ${error.message}
                </div>
            `;
        });
        
        // Test Results API
        fetch(`${baseUrl}/api/test-results`, {
            headers: {
                'Authorization': `Bearer ${token}`
            }
        })
        .then(response => response.json())
        .then(data => {
            document.getElementById('results-result').innerHTML = `
                <div class="success">
                    ✅ Results API Working!<br>
                    Found ${data.count} test results<br>
                    Latest: ${data.results[0]?.test_case_id} (${data.results[0]?.is_correct ? 'Correct' : 'Incorrect'})<br>
                    <strong>All ${data.count} results are available!</strong>
                </div>
            `;
        })
        .catch(error => {
            document.getElementById('results-result').innerHTML = `
                <div class="error">
                    ❌ Results API Error: ${error.message}
                </div>
            `;
        });
        
        // Simulate Dashboard Loading
        Promise.all([
            fetch(`${baseUrl}/api/test-cases/stats`, {
                headers: { 'Authorization': `Bearer ${token}` }
            }).then(r => r.json()),
            fetch(`${baseUrl}/api/test-results`, {
                headers: { 'Authorization': `Bearer ${token}` }
            }).then(r => r.json())
        ])
        .then(([stats, results]) => {
            document.getElementById('dashboard-sim').innerHTML = `
                <div class="info">
                    <h4>Dashboard Should Display:</h4>
                    <p><strong>Total Completed:</strong> ${stats.total}</p>
                    <p><strong>Correct Answers:</strong> ${stats.correct}</p>
                    <p><strong>Incorrect Answers:</strong> ${stats.incorrect}</p>
                    <p><strong>Accuracy Rate:</strong> ${((stats.correct / stats.total) * 100).toFixed(1)}%</p>
                    <hr>
                    <p><strong>Available Test Results:</strong> ${results.count}</p>
                    <p><strong>Latest Test:</strong> ${results.results[0]?.test_case_id}</p>
                </div>
            `;
        })
        .catch(error => {
            document.getElementById('dashboard-sim').innerHTML = `
                <div class="error">
                    ❌ Dashboard Simulation Error: ${error.message}
                </div>
            `;
        });
    </script>
</body>
</html>
